<!DOCTYPE html>
<html>
<head>
    <title>Pemindai QR Code</title>
    <style>
        /* Gaya CSS untuk mengatur tampilan */
        #qr-reader {
            width: 300px;
            height: 300px;
            border: 1px solid #ccc;
            margin: 20px auto;
        }
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>Pemindai QR Code</h1>
    <div id="qr-reader"></div>
    <button id="startButton">Mulai Memindai</button>
    <table id="result-table">
        <thead>
            <tr>
                <th>No.</th>
                <th>Eviden Foto</th>
                <th>Teks Scan</th>
                <th>Waktu Pemindaian</th>
            </tr>
        </thead>
        <tbody id="result-body">
        </tbody>
    </table>

    <script src="html5-qrcode.min.js"></script>
    <script>
        const qrReader = document.getElementById('qr-reader');
        const startButton = document.getElementById('startButton');
        const resultBody = document.getElementById('result-body');
        let scanCount = 1;

        const html5QrcodeScanner = new Html5QrcodeScanner(
            'qr-reader', { fps: 10, qrbox: 250 }
        );

        function startScanning() {
            qrReader.style.display = 'block';
            startButton.style.display = 'none';
            html5QrcodeScanner.render(onScanSuccess);
        }

        function onScanSuccess(decodedText, decodedResult) {
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>${scanCount}</td>
                <td><img src="" alt="Preview Photo ${scanCount}" id="photo-preview${scanCount}"></td>
                <td>${decodedText}</td>
                <td>${new Date().toLocaleString()}</td>
            `;
            resultBody.appendChild(newRow);

            takePhoto(scanCount);
            html5QrcodeScanner.pause();
            scanCount++;
            startButton.style.display = 'block'; // Tampilkan tombol mulai lagi
        }

        function takePhoto(index) {
            const video = document.querySelector('video');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            const photo = canvas.toDataURL('image/jpeg');
            document.getElementById('photo-preview' + index).src = photo;
        }

        startButton.addEventListener('click', startScanning);
    </script>
</body>
</html>
