<!DOCTYPE html>
<html>
<head>
  <title>Pemindai QR Code Berbaris</title>
  <style>
    /* Gaya CSS */
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid black;
      padding: 8px;
      text-align: center;
    }
    #qr-reader {
      display: none;
      width: 300px;
      height: 250px;
    }
    img.result-image {
      max-width: 100%;
      height: auto;
    }
  </style>
</head>
<body>
  <div id="qr-reader"></div>

  <table>
    <tr>
      <th>Teks</th>
      <th>Scan</th>
      <th>Hasil Scan</th>
    </tr>
    <tr>
      <td>ATG CONSOLE</td>
      <td><button class="scanButton" data-row="0">Scan</button></td>
      <td><img class="result-image" id="resultImage0"></td>
    </tr>
    <tr>
      <td>ROUTER</td>
      <td><button class="scanButton" data-row="1">Scan</button></td>
      <td><img class="result-image" id="resultImage1"></td>
    </tr>
    </table>

  <script src="html5-qrcode.min.js"></script>
  <script>
    var html5QrcodeScanner;

    function onScanSuccess(decodedText, decodedResult, row) {
      // Update hasil scan untuk baris tertentu
      document.querySelectorAll('.result')[row].textContent = decodedText;

      // Tampilkan gambar hasil capture
      const resultImage = document.getElementById(`resultImage${row}`);
      resultImage.src = decodedResult.image.src;

      // Sembunyikan tampilan kamera dan aktifkan kembali tombol Scan
      html5QrcodeScanner.pause();
      document.getElementById('qr-reader').style.display = 'none';
      document.querySelectorAll('.scanButton')[row].disabled = false;
    }

    // Inisialisasi scanner QR code
    html5QrcodeScanner = new Html5QrcodeScanner(
      "qr-reader", { fps: 10, qrbox: 250 }
    );

    // Tambahkan event listener ke semua tombol Scan
    const scanButtons = document.querySelectorAll('.scanButton');
    scanButtons.forEach((button) => {
      button.addEventListener('click', () => {
        const row = button.dataset.row;
        startScanning(row);
      });
    });

    function startScanning(row) {
      // Tampilkan tampilan kamera dan nonaktifkan tombol
      document.getElementById('qr-reader').style.display = 'block';
      document.querySelectorAll('.scanButton')[row].disabled = true;

      html5QrcodeScanner.render((decodedText, decodedResult) => {
        onScanSuccess(decodedText, decodedResult, row);
      });
    }
  </script>
</body>
</html>
