<!DOCTYPE html>
<html>
<head>
  <title>Pemindai QR Code</title>
  <style>
    #qr-reader {
      width: 100%;
      height: 100%;
    }
    #photo-preview {
      display: none;
    }
    #result-box p {
      margin-bottom: 0;
    }
    #startButton {
      display: block;
    }
    .row {
      margin-bottom: 10px;
    }
    .result-column {
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="qr-reader"></div>
  <div id="result-box">
    <div class="row">
      <p>Teks 1:</p>
      <button class="scanButton" data-row="0">Scan</button>
      <div class="result-column">
        <p id="resultText0"></p>
        <img id="photoPreview0" src="" alt="Pratinjau Foto">
      </div>
    </div>
    <div class="row">
      <p>Teks 2:</p>
      <button class="scanButton" data-row="1">Scan</button>
      <div class="result-column">
        <p id="resultText1"></p>
        <img id="photoPreview1" src="" alt="Pratinjau Foto">
      </div>
    </div>
  </div>

  <script src="html5-qrcode.min.js"></script>
  <script>
    var html5QrcodeScanner;

    function onScanSuccess(decodedText, decodedResult, row) {
      // Update konten elemen "result-text"
      document.getElementById(`resultText${row}`).textContent = decodedText;

      // Ambil foto dan tampilkan
      takePhoto(row);

      // Hentikan pemindaian dan sembunyikan tampilan kamera
      html5QrcodeScanner.pause();
      document.getElementById('qr-reader').style.display = 'none';
      document.querySelectorAll('.scanButton')[row].style.display = 'block';
    }

    function takePhoto(row) {
      const video = document.querySelector('video');
      const canvas = document.createElement('canvas');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const context = canvas.getContext('2d');
      context.drawImage(video, 0, 0, canvas.width, canvas.height);
      const photo = canvas.toDataURL('image/jpeg');
      document.getElementById(`photoPreview${row}`).src = photo;
      document.getElementById(`photoPreview${row}`).style.display = 'block';
    }

    function startScanning(row) {
      // Tampilkan kembali tampilan kamera dan sembunyikan tombol
      document.getElementById('qr-reader').style.display = 'block';
      document.querySelectorAll('.scanButton')[row].style.display = 'none';

      // Mulai pemindaian
      html5QrcodeScanner.render(onScanSuccess);
    }

    // Inisialisasi tombol Start Scanning
    document.querySelectorAll('.scanButton').forEach(button => {
      button.addEventListener('click', () => {
        const row = button.dataset.row;
        startScanning(row);
      });
    });

    // Inisialisasi scanner QR code
    html5QrcodeScanner = new Html5QrcodeScanner(
      "qr-reader", { fps: 10, qrbox: 250 }
    );
    html5QrcodeScanner.render(onScanSuccess);
  </script>
</body>
</html>
