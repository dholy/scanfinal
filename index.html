<!DOCTYPE html>
<html>
<head>
  <title>Pemindai QR Code</title>
  <style>
    #qr-reader {
      width: 100%;
      height: 100%;
    }
    #photo-preview {
      display: none;
    }
    #result-box p {
      margin-bottom: 0;
    }
    #startButton {
      display: block;
    }
  </style>
</head>
<body>
  <div id="qr-reader"></div>
  <div id="result-box">
    <p id="result-text"></p>
    <img id="photo-preview" src="" alt="Pratinjau Foto">
    <button id="startButton">Start Scanning</button>
  </div>

  <script src="html5-qrcode.min.js"></script>
  <script>
    var html5QrcodeScanner;

    function onScanSuccess(decodedText, decodedResult) {
      // Update konten elemen "result-text"
      document.getElementById('result-text').textContent = decodedText;

      // Ambil foto dan tampilkan
      takePhoto();

      // Hentikan pemindaian dan sembunyikan tampilan kamera
      html5QrcodeScanner.pause();
      document.getElementById('qr-reader').style.display = 'none';
      document.getElementById('startButton').style.display = 'block';
    }

    function takePhoto() {
      const video = document.querySelector('video');
      const canvas = document.createElement('canvas');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const context = canvas.getContext('2d');
      context.drawImage(video, 0, 0, canvas.width, canvas.height);
      const photo = canvas.toDataURL('image/jpeg');
      document.getElementById('photo-preview').src = photo;
      document.getElementById('photo-preview').style.display = 'block';
    }

    function startScanning() {
      // Tampilkan kembali tampilan kamera dan sembunyikan tombol
      document.getElementById('qr-reader').style.display = 'block';
      document.getElementById('startButton').style.display = 'none';

      // Mulai pemindaian
      html5QrcodeScanner.render(onScanSuccess);
    }

    // Inisialisasi tombol Start Scanning
    document.getElementById('startButton').addEventListener('click', startScanning);

    // Inisialisasi scanner QR code
    html5QrcodeScanner = new Html5QrcodeScanner(
      "qr-reader", { fps: 10, qrbox: 250 }
    );
    html5QrcodeScanner.render(onScanSuccess);
  </script>
</body>
</html>
