<!DOCTYPE html>
<html>
<head>
  <title>Pemindai QR Code dengan Lokasi GPS</title>
  <style>
    /* Gaya CSS untuk mengatur tampilan */
    #qr-reader {
      width: 300px;
      height: 300px;
      border: 1px solid #ccc;
      margin: 20px auto;
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #f2f2f2;
    }
  </style>
</head>
<body>
  <h1>Pemindai QR Code dengan Lokasi GPS</h1>
  <div id="qr-reader"></div>
  <button id="startButton">Mulai Memindai</button>
  <table id="result-table">
    <thead>
      <tr>
        <th>No.</th>
        <th>Type Perangkat</th>
        <th>Fhoto Perangkat</th>
        <th>Fhoto Serian Number</th>
        <th>Serian Number</th>
        <th>Waktu Pemindaian</th>
        <th>Lokasi GPS</th>
      </tr>
    </thead>
    <tbody id="result-body">
      <tr>
        <td>ATG PROBE</td>
        <td><img src="" alt="Preview Photo 1" id="photo-preview1"></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>      
      <tr>
        <td>ATG CONSOLE</td>
        <td><img src="" alt="Preview Photo 1" id="photo-preview1"></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>      
    </tbody>
  </table>

  <script src="html5-qrcode.min.js"></script>
  <script>
    const qrReader = document.getElementById('qr-reader');
    const startButton = document.getElementById('startButton');
    const resultBody = document.getElementById('result-body');
    let scanCount = 1;

    const html5QrcodeScanner = new Html5QrcodeScanner(
      'qr-reader', { fps: 10, qrbox: 250 }
    );

    // Fungsi untuk meminta izin lokasi
    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
      } else {
        alert("Geolocation tidak didukung oleh browser ini.");
      }
    }

    // Fungsi untuk menampilkan posisi saat ini
    function showPosition(position) {
      window.scanLocation = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };
    }

    // Fungsi untuk menangani kesalahan saat mendapatkan lokasi
    function showError(error) {
      console.error("Error getting location:", error.message);
      alert("Terjadi kesalahan saat mendapatkan lokasi. Pastikan GPS Anda aktif.");
    }

    function startScanning() {
      getLocation(); // Meminta izin lokasi sebelum memulai pemindaian
      qrReader.style.display = 'block';
      startButton.style.display = 'none';
      html5QrcodeScanner.render(onScanSuccess);
    }

    function onScanSuccess(decodedText, decodedResult) {
      const newRow = document.createElement('tr');
      const additionalColumns = '';  // String untuk menyimpan data kolom tambahan

      // Memproses data kolom tambahan (sesuaikan dengan kebutuhan Anda)
      for (let i = 1; i <= 13; i++) {
        const columnData = prompt(`Masukkan data untuk Kolom ${i} (Kosongi jika tidak ada):`);
        additionalColumns += `<td>${columnData || '-'}</td>`; // Tambahkan '-' jika data kosong
      }

      newRow.innerHTML = `
        <td>${scanCount}</td>
        <span class="math-inline">\{additionalColumns\}  <td\></span>{decodedText}</td>
        <td><span class="math-inline">\{new Date\(\)\.toLocaleString\(\)\}</td\>
<td\></span>{window.scanLocation ? `${window.scanLocation.lat}, ${window.scanLocation.lng}` : '-'}</td>
      `;
